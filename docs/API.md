# HealthTrack API v1 Reference

All API requests require `Content-Type: application/json` and `Authorization: Bearer {token}` for protected routes.

Base URL: `http://localhost:8000/api/v1`

---

## Auth

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/auth/register` | Register |
| POST | `/auth/login` | Login |
| GET | `/auth/me` | Current user |
| POST | `/auth/logout` | Logout |
| POST | `/auth/google` | Google OAuth |

---

## Profile

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/profile/show` | Get profile |
| PUT | `/profile/update` | Update profile |

---

## Glucose

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/glucose` | List readings (query: `from`, `to`) |
| POST | `/glucose` | Create reading |
| GET | `/glucose/{id}` | Get reading |
| PUT | `/glucose/{id}` | Update reading |
| DELETE | `/glucose/{id}` | Delete reading |

**POST/PUT body:**
```json
{
  "original_value": 95,
  "unit": "mg_dl",
  "measurement_context": "fasting",
  "measured_at": "2026-02-21T08:30:00",
  "notes": "Before breakfast"
}
```
`unit`: `mg_dl` | `mmol_l`  
`measurement_context`: `fasting` | `before_meal` | `after_meal` | `random` | `bedtime`

---

## Conditions

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/conditions` | List user conditions |
| POST | `/conditions` | Add condition |
| GET | `/conditions/{id}` | Get condition |
| PUT | `/conditions/{id}` | Update condition |
| DELETE | `/conditions/{id}` | Remove condition |

**POST/PUT body:**
```json
{
  "condition_type": "diabetes_type_2",
  "diagnosed_at": "2020-01-15",
  "status": "active",
  "notes": "Diagnosed by Dr. Smith"
}
```
`condition_type`: `diabetes_type_1` | `diabetes_type_2` | `hypertension` | `hyperlipidemia`  
`status`: `active` | `inactive` | `resolved`

---

## Drugs (Master Data)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/drugs` | List drugs (query: `search`, `insulin_type`, `therapeutic_class`, `per_page`) |
| GET | `/drugs/{id}` | Get drug |

---

## Prescriptions

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/prescriptions` | List prescriptions (query: `status`, `condition_id`, `per_page`) |
| POST | `/prescriptions` | Add prescription |
| GET | `/prescriptions/{id}` | Get prescription |
| PUT | `/prescriptions/{id}` | Update prescription |
| DELETE | `/prescriptions/{id}` | Remove prescription |

**POST/PUT body:**
```json
{
  "drug_id": 1,
  "user_condition_id": 1,
  "dosage": "500mg",
  "schedule": "BID with meals",
  "rule_id": "sliding_scale_insulin",
  "started_at": "2026-01-01",
  "ended_at": null,
  "status": "active"
}
```
`user_condition_id` must belong to the current user. `rule_id` is optional (e.g. for sliding scale).

---

## Administration Logs

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/administration-logs` | List logs (query: `prescription_id`, `from`, `to`, `per_page`) |
| POST | `/administration-logs` | Log medication taken |
| GET | `/administration-logs/{id}` | Get log |

**POST body:**
```json
{
  "prescription_id": 1,
  "taken_at": "2026-02-21T08:00:00",
  "dose": "500mg",
  "glucose_reading_id": 1,
  "notes": "With breakfast"
}
```
`prescription_id` must belong to the current user. `glucose_reading_id` optional.

---

## Medication Suggestions

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/medication-suggestions` | List suggestions (query: `unacknowledged_only`, `from`, `to`, `per_page`) |
| GET | `/medication-suggestions/{id}` | Get suggestion |
| POST | `/medication-suggestions/{id}/acknowledge` | Acknowledge suggestion |

Suggestions are generated by the rule engine when glucose readings trigger medication adjustment logic (e.g. sliding scale insulin).

---

## Setup

Run migrations and seed drugs:

```bash
php artisan migrate
php artisan db:seed --class=DrugSeeder
```
